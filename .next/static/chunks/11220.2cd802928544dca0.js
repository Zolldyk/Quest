"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[11220,26489],{11220:(e,t,a)=>{a.d(t,{connectSmartAccount:()=>eV,disconnectSmartAccount:()=>eD});var r=a(39696),n=a(55389),i=a(23802),s=a(2579),o=a(26489);let c=[{name:"owner",type:"address"},{name:"spender",type:"address"}],d=[{type:"uint256"}];async function m(e){return(0,o.readContract)({contract:e.contract,method:["0xdd62ed3e",c,d],params:[e.owner,e.spender]})}var p=a(19131),l=a(3702),y=a(66971);let u=[{name:"spender",type:"address"},{name:"value",type:"uint256"}],f=[{type:"bool"}];var v=a(58528),h=a(49386);let w=[{name:"signer",type:"address"}],g=[{components:[{name:"signer",type:"address"},{name:"approvedTargets",type:"address[]"},{name:"nativeTokenLimitPerTransaction",type:"uint256"},{name:"startTimestamp",type:"uint128"},{name:"endTimestamp",type:"uint128"}],name:"permissions",type:"tuple"}];async function G(e){return(0,o.readContract)({contract:e.contract,method:["0xf15d424e",w,g],params:[e.signer]})}let A=[{components:[{name:"signer",type:"address"},{name:"isAdmin",type:"uint8"},{name:"approvedTargets",type:"address[]"},{name:"nativeTokenLimitPerTransaction",type:"uint256"},{name:"permissionStartTimestamp",type:"uint128"},{name:"permissionEndTimestamp",type:"uint128"},{name:"reqValidityStartTimestamp",type:"uint128"},{name:"reqValidityEndTimestamp",type:"uint128"},{name:"uid",type:"bytes32"}],name:"req",type:"tuple"},{name:"signature",type:"bytes"}],L=[];var P=a(40651);function T(){return new Date(Date.now()+31536e7)}function x(e){return(0,P.Dg)(Math.floor(e.getTime()/1e3))}var b=a(25955);let O=[{name:"signer",type:"address"},{name:"isAdmin",type:"uint8"},{name:"approvedTargets",type:"address[]"},{name:"nativeTokenLimitPerTransaction",type:"uint256"},{name:"permissionStartTimestamp",type:"uint128"},{name:"permissionEndTimestamp",type:"uint128"},{name:"reqValidityStartTimestamp",type:"uint128"},{name:"reqValidityEndTimestamp",type:"uint128"},{name:"uid",type:"bytes32"}];async function V(e){let{account:t,contract:a,req:r}=e,n=await t.signTypedData({domain:{chainId:a.chain.id,name:"Account",verifyingContract:a.address,version:"1"},message:r,primaryType:"SignerPermissionRequest",types:{SignerPermissionRequest:O}});return{req:r,signature:n}}async function D(e){let{target:t,permissions:a}=e;return{approvedTargets:"*"===a.approvedTargets?[v.cF]:a.approvedTargets,isAdmin:0,nativeTokenLimitPerTransaction:(0,p.fq)(a.nativeTokenLimitPerTransaction?.toString()||"0"),permissionEndTimestamp:x(a.permissionEndTimestamp||T()),permissionStartTimestamp:x(a.permissionStartTimestamp||new Date(0)),reqValidityEndTimestamp:x(T()),reqValidityStartTimestamp:0n,signer:t,uid:await (0,b.O)()}}async function C(e){var t,a;let{accountContract:r,sessionKeyAddress:n,newPermissions:i}=e;if(!await (0,h.isContractDeployed)(r))return!0;let s=await G({contract:r,signer:n});return!!(s.endTimestamp&&s.endTimestamp<Math.floor(Date.now()/1e3)||(t=s.approvedTargets,!("*"===(a=i.approvedTargets)&&1===t.length&&t[0]===v.cF||"*"!==a&&a.map(e=>e.toLowerCase()).every(e=>t.map(e=>e.toLowerCase()).includes(e))))||(0,p.fq)(i.nativeTokenLimitPerTransaction?.toString()??"0")>s.nativeTokenLimitPerTransaction)}var k=a(23316),I=a(81647),E=a(99134),F=a(99232),$=a(67316),q=a(94),S=a(94879);let M=2n**96n-1n;var U=a(40633),H=a(54500),B=a(14408),_=a(40310),j=a(48624);let z=[{name:"sender",type:"address"},{name:"key",type:"uint192"}],K=[{name:"nonce",type:"uint256"}];async function R(e){return(0,o.readContract)({contract:e.contract,method:["0x35567e1a",z,K],params:[e.sender,e.key]})}let W=[{components:[{name:"sender",type:"address"},{name:"nonce",type:"uint256"},{name:"initCode",type:"bytes"},{name:"callData",type:"bytes"},{name:"callGasLimit",type:"uint256"},{name:"verificationGasLimit",type:"uint256"},{name:"preVerificationGas",type:"uint256"},{name:"maxFeePerGas",type:"uint256"},{name:"maxPriorityFeePerGas",type:"uint256"},{name:"paymasterAndData",type:"bytes"},{name:"signature",type:"bytes"}],name:"userOp",type:"tuple"}],N=[{type:"bytes32"}];async function Y(e){return(0,o.readContract)({contract:e.contract,method:["0xa6193531",W,N],params:[e.userOp]})}let Q=[{components:[{name:"sender",type:"address"},{name:"nonce",type:"uint256"},{name:"initCode",type:"bytes"},{name:"callData",type:"bytes"},{name:"accountGasLimits",type:"bytes32"},{name:"preVerificationGas",type:"uint256"},{name:"gasFees",type:"bytes32"},{name:"paymasterAndData",type:"bytes"},{name:"signature",type:"bytes"}],name:"userOp",type:"tuple"}],J=[{type:"bytes32"}];async function Z(e){return(0,o.readContract)({contract:e.contract,method:["0x22cdde4c",Q,J],params:[e.userOp]})}var X=a(66043),ee=a(8121),et=a(33267),ea=a(23471),er=a(95821),en=a(98864),ei=a(43324),es=a(8118),eo=a(15693),ec=a(99443),ed=a(72556);async function em(e){let{userOp:t,paymasterOverride:a,client:r,chain:n,entrypointAddress:i}=e;if(a)return a(t);let s=i??B.uh,o=(0,B.RZ)(n),c={id:1,jsonrpc:"2.0",method:"pm_sponsorUserOperation",params:[(0,ed.K)(t),s]},d=(0,en.getClientFetch)(r),m=await d(o,{body:(0,es.stringify)(c),headers:{"Content-Type":"application/json"},method:"POST"});if(!m.ok){let e=await m.text()||m.statusText;throw Error(`Paymaster error: ${m.status} - ${e}`)}let p=await m.json();if(p.result)return"string"==typeof p.result?{paymasterAndData:p.result}:(p.result.reason&&console.warn(`Paymaster policy rejected this transaction with reason: ${p.result.reason} ${p.result.policyId?`(policyId: ${p.result.policyId})`:""}`),{callGasLimit:p.result.callGasLimit?(0,ea.uU)(p.result.callGasLimit):void 0,paymaster:p.result.paymaster,paymasterAndData:p.result.paymasterAndData,paymasterData:p.result.paymasterData,paymasterPostOpGasLimit:p.result.paymasterPostOpGasLimit?(0,ea.uU)(p.result.paymasterPostOpGasLimit):void 0,paymasterVerificationGasLimit:p.result.paymasterVerificationGasLimit?(0,ea.uU)(p.result.paymasterVerificationGasLimit):void 0,preVerificationGas:p.result.preVerificationGas?(0,ea.uU)(p.result.preVerificationGas):void 0,verificationGasLimit:p.result.verificationGasLimit?(0,ea.uU)(p.result.verificationGasLimit):void 0});let l=p.error?.message||p.error||m.statusText||"unknown error";throw Error(`Paymaster error from ${o}: ${l}`)}let ep=new Set,el=e=>`${e.chain.id}:${e.address}`,ey=e=>{ep.add(el(e))},eu=e=>{ep.delete(el(e))},ef=e=>ep.has(el(e));async function ev(e){let t=e.timeoutMs||12e4,a=e.intervalMs||1e3,r=Date.now()+t;for(;Date.now()<r;){let t=await (0,U.JI)(e);if(t)return t;await new Promise(e=>setTimeout(e,a))}throw Error(`Timeout waiting for userOp to be mined on chain ${e.chain.id} with UserOp hash: ${e.userOpHash}`)}async function eh(e){let{transaction:t,accountContract:a,factoryContract:r,adminAddress:n,overrides:i,sponsorGas:s,waitForDeployment:o=!0,isDeployedOverride:c}=e,d=t.chain,m=t.client,p={bundlerUrl:i?.bundlerUrl,chain:d,client:m,entrypointAddress:i?.entrypointAddress},l=(0,B.Fn)(e.overrides?.entrypointAddress||B.uh),[y,u,f,v,w]=await Promise.all(["boolean"==typeof c?c:(0,h.isContractDeployed)(a).then(e=>e||ef(a)),(0,ee.encode)(t),(0,q.r)(t.gas),ew({bundlerOptions:p,chain:d,client:m,executeTx:t}),eT({accountContract:a,chain:d,client:m,entrypointAddress:i?.entrypointAddress,getNonceOverride:i?.getAccountNonce})]),{maxFeePerGas:g,maxPriorityFeePerGas:G}=v;return"v0.7"===l?eg({accountContract:a,adminAddress:n,bundlerOptions:p,callData:u,callGasLimit:f,factoryContract:r,isDeployed:y,maxFeePerGas:g,maxPriorityFeePerGas:G,nonce:w,overrides:i,sponsorGas:s,waitForDeployment:o}):eG({accountContract:a,adminAddress:n,bundlerOptions:p,callData:u,callGasLimit:f,factoryContract:r,isDeployed:y,maxFeePerGas:g,maxPriorityFeePerGas:G,nonce:w,overrides:i,sponsorGas:s,waitForDeployment:o})}async function ew(e){let{executeTx:t,bundlerOptions:a,chain:r,client:n}=e,{maxFeePerGas:i,maxPriorityFeePerGas:s}=t,o=a?.bundlerUrl??(0,B.RZ)(r);if((0,en.isThirdwebUrl)(o)){let e=await (0,U.fB)({options:a});i=e.maxFeePerGas,s=e.maxPriorityFeePerGas}else{let[e,t]=await Promise.all([(0,q.r)(i),(0,q.r)(s)]);if(e&&t)i=e,s=t;else{let a=await (0,X.G)(n,r);s=t??a.maxPriorityFeePerGas??0n,i=e??a.maxFeePerGas??0n}}return{maxFeePerGas:i,maxPriorityFeePerGas:s}}async function eg(e){let t,a,{bundlerOptions:r,isDeployed:n,factoryContract:i,accountContract:s,adminAddress:o,sponsorGas:c,overrides:d,nonce:m,callData:p,callGasLimit:l,maxFeePerGas:y,maxPriorityFeePerGas:u,waitForDeployment:f}=e,{chain:v,client:h}=r;n?(a="0x",f&&await ex(s)):(t=i.address,a=await (0,ee.encode)((0,H.HM)({accountSalt:d?.accountSalt,adminAddress:o,createAccountOverride:d?.createAccount,factoryContract:i})),f&&ey(s));let w={callData:p,callGasLimit:l??0n,factory:t,factoryData:a,maxFeePerGas:y,maxPriorityFeePerGas:u,nonce:m,paymaster:void 0,paymasterData:"0x",paymasterPostOpGasLimit:0n,paymasterVerificationGasLimit:0n,preVerificationGas:0n,sender:s.address,signature:B.km,verificationGasLimit:0n};if(c){let e=await em({chain:v,client:h,entrypointAddress:d?.entrypointAddress,paymasterOverride:d?.paymaster,userOp:w});if(e.paymaster&&e.paymasterData&&(w.paymaster=e.paymaster,w.paymasterData=e.paymasterData),e.callGasLimit&&e.verificationGasLimit&&e.preVerificationGas&&e.paymasterPostOpGasLimit&&e.paymasterVerificationGasLimit)w.callGasLimit=e.callGasLimit,w.verificationGasLimit=e.verificationGasLimit,w.preVerificationGas=e.preVerificationGas,w.paymasterPostOpGasLimit=e.paymasterPostOpGasLimit,w.paymasterVerificationGasLimit=e.paymasterVerificationGasLimit;else{let e=d?.tokenPaymaster?{[d.tokenPaymaster.tokenAddress]:{stateDiff:{[(0,ei.S)((0,et.hd)([{type:"address"},{type:"uint256"}],[s.address,d.tokenPaymaster.balanceStorageSlot]))]:(0,ea.nj)(_.EA,{size:32})}}}:void 0,t=await (0,U.yY)({options:r,userOp:w},e);w.callGasLimit=t.callGasLimit,w.verificationGasLimit=t.verificationGasLimit,w.preVerificationGas=t.preVerificationGas,w.paymasterPostOpGasLimit=d?.tokenPaymaster?500000n:t.paymasterPostOpGasLimit||0n,w.paymasterVerificationGasLimit=t.paymasterVerificationGasLimit||0n;let a=await em({chain:v,client:h,entrypointAddress:d?.entrypointAddress,paymasterOverride:d?.paymaster,userOp:w});a.paymaster&&a.paymasterData&&(w.paymaster=a.paymaster,w.paymasterData=a.paymasterData)}}else{let e=await (0,U.yY)({options:r,userOp:w});w.callGasLimit=e.callGasLimit,w.verificationGasLimit=e.verificationGasLimit,w.preVerificationGas=e.preVerificationGas,w.paymasterPostOpGasLimit=e.paymasterPostOpGasLimit||0n,w.paymasterVerificationGasLimit=e.paymasterVerificationGasLimit||0n}return{...w,signature:"0x"}}async function eG(e){let t,{bundlerOptions:a,isDeployed:r,factoryContract:n,accountContract:i,adminAddress:s,sponsorGas:o,overrides:c,nonce:d,callData:m,callGasLimit:p,maxFeePerGas:l,maxPriorityFeePerGas:y,waitForDeployment:u}=e,{chain:f,client:v}=a;r?(t="0x",u&&await ex(i)):(t=await eP({accountSalt:c?.accountSalt,adminAddress:s,createAccountOverride:c?.createAccount,factoryContract:n}),u&&ey(i));let h={callData:m,callGasLimit:p??0n,initCode:t,maxFeePerGas:l,maxPriorityFeePerGas:y,nonce:d,paymasterAndData:"0x",preVerificationGas:0n,sender:i.address,signature:B.km,verificationGasLimit:0n};if(o){let e=await em({chain:f,client:v,entrypointAddress:c?.entrypointAddress,paymasterOverride:c?.paymaster,userOp:h}),t="paymasterAndData"in e?e.paymasterAndData:"0x";if(t&&"0x"!==t&&(h.paymasterAndData=t),e.callGasLimit&&e.verificationGasLimit&&e.preVerificationGas)h.callGasLimit=e.callGasLimit,h.verificationGasLimit=e.verificationGasLimit,h.preVerificationGas=e.preVerificationGas;else{let e=await (0,U.yY)({options:a,userOp:h});if(h.callGasLimit=e.callGasLimit,h.verificationGasLimit=e.verificationGasLimit,h.preVerificationGas=e.preVerificationGas,t&&"0x"!==t){let e=await em({chain:f,client:v,entrypointAddress:c?.entrypointAddress,paymasterOverride:c?.paymaster,userOp:h}),t="paymasterAndData"in e?e.paymasterAndData:"0x";t&&"0x"!==t&&(h.paymasterAndData=t)}}}else{let e=await (0,U.yY)({options:a,userOp:h});h.callGasLimit=e.callGasLimit,h.verificationGasLimit=e.verificationGasLimit,h.preVerificationGas=e.preVerificationGas}return{...h,signature:"0x"}}async function eA(e){let{userOp:t,chain:a,entrypointAddress:r,adminAccount:n}=e,i=await eL({chain:a,client:e.client,entrypointAddress:r,userOp:t});if(n.signMessage){let e=await n.signMessage({chainId:a.id,message:{raw:(0,er.aT)(i)},originalMessage:(0,es.stringify)(t)});return{...t,signature:e}}throw Error("signMessage not implemented in signingAccount")}async function eL(e){let t,{userOp:a,chain:r,entrypointAddress:n}=e;if("v0.7"===(0,B.Fn)(n||B.uh)){let i={accountGasLimits:(0,j.xW)([(0,eo.eV)((0,ec.nj)(BigInt(a.verificationGasLimit)),{size:16}),(0,eo.eV)((0,ec.nj)(BigInt(a.callGasLimit)),{size:16})]),callData:a.callData,gasFees:(0,j.xW)([(0,eo.eV)((0,ec.nj)(BigInt(a.maxPriorityFeePerGas)),{size:16}),(0,eo.eV)((0,ec.nj)(BigInt(a.maxFeePerGas)),{size:16})]),initCode:a.factory?(0,j.xW)([a.factory,a.factoryData||"0x"]):"0x",nonce:BigInt(a.nonce),paymasterAndData:a.paymaster?(0,j.xW)([a.paymaster,(0,eo.eV)((0,ec.nj)(BigInt(a.paymasterVerificationGasLimit||0)),{size:16}),(0,eo.eV)((0,ec.nj)(BigInt(a.paymasterPostOpGasLimit||0)),{size:16}),a.paymasterData||"0x"]):"0x",preVerificationGas:BigInt(a.preVerificationGas),sender:a.sender,signature:a.signature};t=await Z({contract:(0,s.P)({address:n||B.nF,chain:r,client:e.client}),userOp:i})}else t=await Y({contract:(0,s.P)({address:n||B.uh,chain:r,client:e.client}),userOp:a});return t}async function eP(e){let{factoryContract:t,adminAddress:a,accountSalt:r,createAccountOverride:n}=e,i=(0,H.HM)({accountSalt:r,adminAddress:a,createAccountOverride:n,factoryContract:t});return(0,j.xW)([t.address,await (0,ee.encode)(i)])}async function eT(e){let{accountContract:t,chain:a,client:r,entrypointAddress:n,getNonceOverride:i}=e;return i?i(t):await R({contract:(0,s.P)({address:n||B.uh,chain:a,client:r}),key:(0,ed.t)(),sender:t.address})}async function ex(e){let t=Date.now();for(;ef(e);){if(Date.now()-t>6e4)throw eu(e),Error("Account deployment is taking too long (over 1 minute). Please try again.");await new Promise(e=>setTimeout(e,500))}}let eb=new WeakMap,eO=new WeakMap;async function eV(e,t){let{personalAccount:a,client:r}=e;if(!a)throw Error("No personal account provided for smart account connection");let o=t.chain,c="gasless"in t?t.gasless:t.sponsorGas;if(await (0,$.k)(o))return[function(e){let{creationOptions:t,connectionOptions:a,chain:r}=e,s={address:(0,F.bv)(a.personalAccount.address),onTransactionRequested:async e=>a.personalAccount.onTransactionRequested?.(e),async sendTransaction(o){let c={chain:(0,i.Q4)(o.chainId),client:a.client,data:o.data,eip712:o.eip712,to:o.to??void 0,value:o.value??0n},d=await (0,E.f)({account:s,transaction:c});if(e.sponsorGas&&!d.paymaster){let e=await (0,U.qq)({options:{bundlerUrl:t.overrides?.bundlerUrl,chain:r,client:a.client,entrypointAddress:t.overrides?.entrypointAddress},transaction:d});d={...d,...e}}let m=await (0,E.a)({account:s,chainId:r.id,eip712Transaction:d}),p=await (0,U.vx)({options:{bundlerUrl:t.overrides?.bundlerUrl,chain:r,client:a.client,entrypointAddress:t.overrides?.entrypointAddress},signedTransaction:m,transaction:d});return(0,n.E)({chainId:r.id,client:a.client,contractAddress:o.to??void 0,transactionHash:p.transactionHash,walletAddress:s.address,walletType:"smart"}),{chain:r,client:a.client,transactionHash:p.transactionHash}},signMessage:async({message:e})=>a.personalAccount.signMessage({message:e}),async signTypedData(e){let t=(0,S.y)(e);return a.personalAccount.signTypedData(t)}};return s}({chain:o,connectionOptions:e,creationOptions:t,sponsorGas:c}),o];if(t.factoryAddress&&!t.overrides?.entrypointAddress){let e=await eE(t.factoryAddress,r,o);e&&(t.overrides={...t.overrides,entrypointAddress:e})}t.overrides?.tokenPaymaster&&!t.overrides?.entrypointAddress&&(t.overrides={...t.overrides,entrypointAddress:B.nF});let d=t.factoryAddress??(0,B.Fd)(t.overrides?.entrypointAddress),m=(0,s.P)({address:d,chain:o,client:r}),p=await (0,H.Mi)({accountAddress:t.overrides?.accountAddress,accountSalt:t.overrides?.accountSalt,adminAddress:a.address,factoryContract:m,predictAddressOverride:t.overrides?.predictAddress}).then(e=>e).catch(e=>{throw Error(`Failed to get account address with factory contract ${m.address} on chain ID ${o.id}: ${e?.message||"unknown error"}`,{cause:e})}),u=(0,s.P)({address:p,chain:o,client:r}),f=await eC({...t,accountContract:u,chain:o,client:r,factoryContract:m,personalAccount:a,sponsorGas:c});if(eb.set(a,f),eO.set(f,a),t.sessionKey&&await C({accountContract:u,newPermissions:t.sessionKey.permissions,sessionKeyAddress:t.sessionKey.address})){let e=function(e){let{contract:t,sessionKeyAddress:a,account:r,permissions:n}=e;var i={async asyncParams(){let{req:e,signature:i}=await V({account:r,contract:t,req:await D({permissions:n,target:a})});return{req:e,signature:i}},contract:t};let s=(0,y.O)(async()=>"asyncParams"in i?await i.asyncParams():i);return(0,l.m)({accessList:async()=>(await s()).overrides?.accessList,authorizationList:async()=>(await s()).overrides?.authorizationList,contract:i.contract,erc20Value:async()=>(await s()).overrides?.erc20Value,extraGas:async()=>(await s()).overrides?.extraGas,gas:async()=>(await s()).overrides?.gas,gasPrice:async()=>(await s()).overrides?.gasPrice,maxFeePerGas:async()=>(await s()).overrides?.maxFeePerGas,maxPriorityFeePerGas:async()=>(await s()).overrides?.maxPriorityFeePerGas,method:["0x5892e236",A,L],nonce:async()=>(await s()).overrides?.nonce,params:async()=>{let e=await s();return[e.req,e.signature]},value:async()=>(await s()).overrides?.value})}({account:a,contract:u,permissions:t.sessionKey.permissions,sessionKeyAddress:t.sessionKey.address});await (0,k.sendTransaction)({account:f,transaction:e})}return[f,o]}async function eD(e){let t=eO.get(e);t&&(eb.delete(t),eO.delete(e))}async function eC(e){let t=e.overrides?.tokenPaymaster;if(t&&"v0.7"!==(0,B.Fn)(e.overrides?.entrypointAddress||B.uh))throw Error("Token paymaster is only supported for entrypoint version v0.7");let r=e.accountContract,o={address:(0,F.bv)(r.address),onTransactionRequested:async t=>e.personalAccount.onTransactionRequested?.(t),async sendBatchTransaction(t){let a=(0,H.zi)({accountContract:r,executeBatchOverride:e.overrides?.executeBatch,transactions:t});if(0===t.length)throw Error("No transactions to send");let s=t[0];if(!s)throw Error("No transactions to send");let o=(0,i.Q4)(s.chainId),c=await eI({executeTx:a,options:{...e,accountContract:r,chain:o}});return(0,n.E)({chainId:o.id,client:e.client,contractAddress:t[0]?.to??void 0,transactionHash:c.transactionHash,walletAddress:e.accountContract.address,walletType:"smart"}),c},async sendTransaction(a){let c;if(t){await ek({accountContract:r,erc20Paymaster:t,options:e});let a=async()=>({paymaster:t.paymasterAddress,paymasterData:"0x"});c=e.overrides?.paymaster||a}else c=e.overrides?.paymaster;a.chainId!==r.chain.id&&(r=(0,s.P)({address:o.address,chain:(0,i.Q4)(a.chainId),client:e.client}));let d=(0,H.Lc)({accountContract:r,executeOverride:e.overrides?.execute,transaction:a}),m=(0,i.Q4)(a.chainId),p=await eI({executeTx:d,options:{...e,accountContract:r,chain:m,overrides:{...e.overrides,paymaster:c}}});return(0,n.E)({chainId:m.id,client:e.client,contractAddress:a.to??void 0,transactionHash:p.transactionHash,walletAddress:e.accountContract.address,walletType:"smart"}),p},async signMessage({message:t}){if(e.overrides?.signMessage)return e.overrides.signMessage({accountContract:r,adminAccount:e.personalAccount,factoryContract:e.factoryContract,message:t});let{smartAccountSignMessage:n}=await a.e(28835).then(a.bind(a,28835));return n({accountContract:r,factoryContract:e.factoryContract,message:t,options:e})},async signTypedData(t){if(e.overrides?.signTypedData)return e.overrides.signTypedData({accountContract:r,adminAccount:e.personalAccount,factoryContract:e.factoryContract,typedData:t});let{smartAccountSignTypedData:n}=await a.e(28835).then(a.bind(a,28835));return n({accountContract:r,factoryContract:e.factoryContract,options:e,typedData:t})}};return o}async function ek(e){let{accountContract:t,erc20Paymaster:r,options:n}=e,i=r.tokenAddress,o=(0,s.P)({address:i,chain:t.chain,client:t.client});if(await m({contract:o,owner:t.address,spender:r.paymasterAddress})>0n)return;let c=function(e){var t={asyncParams:async()=>{let t;if("amount"in e){let{decimals:r}=await a.e(96491).then(a.bind(a,96491)),n=await r(e).catch(()=>18);t=(0,p.J1)(e.amount.toString(),n)}else t=e.amountWei;return{overrides:{erc20Value:{amountWei:t,tokenAddress:e.contract.address}},spender:e.spender,value:t}},contract:e.contract};let r=(0,y.O)(async()=>"asyncParams"in t?await t.asyncParams():t);return(0,l.m)({accessList:async()=>(await r()).overrides?.accessList,authorizationList:async()=>(await r()).overrides?.authorizationList,contract:t.contract,erc20Value:async()=>(await r()).overrides?.erc20Value,extraGas:async()=>(await r()).overrides?.extraGas,gas:async()=>(await r()).overrides?.gas,gasPrice:async()=>(await r()).overrides?.gasPrice,maxFeePerGas:async()=>(await r()).overrides?.maxFeePerGas,maxPriorityFeePerGas:async()=>(await r()).overrides?.maxPriorityFeePerGas,method:["0x095ea7b3",u,f],nonce:async()=>(await r()).overrides?.nonce,params:async()=>{let e=await r();return[e.spender,e.value]},value:async()=>(await r()).overrides?.value})}({amountWei:M-1n,contract:o,spender:r.paymasterAddress}),d=await (0,I.$)({from:t.address,transaction:c}),v=(0,H.Lc)({accountContract:t,executeOverride:n.overrides?.execute,transaction:d});await eI({executeTx:v,options:{...n,overrides:{...n.overrides,tokenPaymaster:void 0}}})}async function eI(e){let{executeTx:t,options:a}=e;try{let e=await eh({accountContract:a.accountContract,adminAddress:a.personalAccount.address,factoryContract:a.factoryContract,overrides:a.overrides,sponsorGas:a.sponsorGas,transaction:t}),r=await eA({adminAccount:a.personalAccount,chain:a.chain,client:a.client,entrypointAddress:a.overrides?.entrypointAddress,userOp:e}),i={bundlerUrl:a.overrides?.bundlerUrl,chain:a.chain,client:a.client,entrypointAddress:a.overrides?.entrypointAddress},s=await (0,U.Ro)({options:i,userOp:r}),o=await ev({...i,userOpHash:s});return(0,n.E)({chainId:a.chain.id,client:a.client,contractAddress:await (0,q.r)(t.to??void 0),transactionHash:o.transactionHash,walletAddress:a.accountContract.address,walletType:"smart"}),{chain:a.chain,client:a.client,transactionHash:o.transactionHash}}catch(e){throw(0,r.Y)(e)&&(0,n.z)({chainId:a.chain.id,client:a.client,contractAddress:await (0,q.r)(t.to??void 0),error:e,transactionValue:await (0,q.r)(t.value),walletAddress:a.accountContract.address}),e}finally{eu(a.accountContract)}}async function eE(e,t,a){let r=(0,s.P)({address:e,chain:a,client:t});try{return await (0,o.readContract)({contract:r,method:"function entrypoint() public view returns (address)"})}catch{return}}},23316:(e,t,a)=>{a.r(t),a.d(t,{sendTransaction:()=>i});var r=a(58645),n=a(81647);async function i(e){let{account:t,transaction:i,gasless:s}=e;if(t.onTransactionRequested&&await t.onTransactionRequested(i),i.eip712){let{sendEip712Transaction:e}=await a.e(99134).then(a.bind(a,99134));return e({account:t,transaction:i})}let o=await (0,n.$)({from:t,transaction:i});if(s){let{sendGaslessTransaction:e}=await a.e(36276).then(a.bind(a,36276));return e({account:t,gasless:s,serializableTransaction:o,transaction:i})}let c=await t.sendTransaction(o);return(0,r.Kj)({address:t.address,chainId:i.chain.id,transactionHash:c.transactionHash}),{...c,chain:i.chain,client:i.client}}},26489:(e,t,a)=>{a.d(t,{readContract:()=>l});var r=a(57368),n=a(31276),i=a(23471);async function s(e,t){let{blockNumber:a,blockTag:r,...n}=t,s=(a?(0,i.cK)(a):void 0)||r||"latest";return await e({method:"eth_call",params:t.stateOverrides?[n,s,Object.fromEntries(Object.entries(t.stateOverrides).map(([e,t])=>[e,{balance:t.balance?(0,i.cK)(t.balance):void 0,code:t.code,nonce:t.nonce?(0,i.cK)(t.nonce):void 0,state:t.state,stateDiff:t.stateDiff}]))]:[n,s]})}var o=a(92942),c=a(33267),d=a(79840),m=a(99232),p=a(36217);async function l(e){let t,{contract:a,method:i,params:l}=e,y=async()=>{if(Array.isArray(i))return i;if((0,p.d)(i))return(0,d.v)(i);if("function"==typeof i)return(0,d.v)(await i(a));if("string"==typeof i&&i.startsWith("function ")){let e=(0,r.$)(i);if("function"===e.type)return(0,d.v)(e);throw Error('"method" passed is not of type "function"')}if(a.abi&&a.abi?.length>0){let e=a.abi?.find(e=>"function"===e.type&&e.name===i);if(e)return(0,d.v)(e)}throw Error(`Could not resolve method "${i}".`)},[u,f]=await Promise.all([y(),"function"==typeof l?l():l]);t=0===u[1].length?u[0]:u[0]+(0,c.hd)(u[1],f).slice(2);let v=(0,o.getRpcClient)({chain:a.chain,client:a.client}),h=await s(v,{data:t,from:e.from?(0,m.bv)(e.from):void 0,to:a.address}),w=(0,n.n)(u[2],h);return Array.isArray(w)&&1===w.length?w[0]:w}},54500:(e,t,a)=>{a.d(t,{HM:()=>d,Lc:()=>m,Mi:()=>c,zi:()=>p});var r=a(3702),n=a(26489),i=a(53360),s=a(23471),o=a(72980);async function c(e){let{factoryContract:t,predictAddressOverride:a,adminAddress:r,accountSalt:c,accountAddress:d}=e;if(a)return a(t,r);if(d)return d;if(!r)throw Error("Account address is required to predict the smart wallet address.");return(0,o.n)(async()=>{let e,a=c&&(0,i.q)(c)?c:(0,s.i3)(c??""),o=0;for(;o<=3;)try{e=await (0,n.readContract)({contract:t,method:"function getAddress(address, bytes) returns (address)",params:[r,a]});break}catch(t){if(3===o)throw t;let e=2**(o+1)*200;await new Promise(t=>setTimeout(t,e)),o++}if(!e)throw Error(`No smart account address found for admin address ${r} and salt ${c}`);return e},{cacheKey:`${e.factoryContract.chain.id}-${e.factoryContract.address}-${e.adminAddress}-${e.accountSalt}`,cacheTime:864e5})}function d(e){let{adminAddress:t,factoryContract:a,createAccountOverride:n,accountSalt:o}=e;if(n)return n(a,t);let c=o&&(0,i.q)(o)?o:(0,s.i3)(o??"");return(0,r.m)({contract:a,method:"function createAccount(address, bytes) returns (address)",params:[t,c]})}function m(e){let{accountContract:t,transaction:a,executeOverride:n}=e;if(n)return n(t,a);let i=a.value||0n;return(295===a.chainId||296===a.chainId)&&(i=BigInt(i)/BigInt(1e10)),(0,r.m)({contract:t,gas:a.gas?a.gas+21000n:void 0,method:"function execute(address, uint256, bytes)",params:[a.to||"",i,a.data||"0x"]})}function p(e){let{accountContract:t,transactions:a,executeBatchOverride:n}=e;if(n)return n(t,a);let i=a.map(e=>e.value||0n),s=a[0]?.chainId;return(295===s||296===s)&&(i=i.map(e=>BigInt(e)/BigInt(1e10))),(0,r.m)({contract:t,method:"function executeBatch(address[], uint256[], bytes[])",params:[a.map(e=>e.to||""),i,a.map(e=>e.data||"0x")]})}},58528:(e,t,a)=>{a.d(t,{DG:()=>r,cF:()=>i,dw:()=>n});let r="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee";function n(e){return e.toLowerCase()===r}let i="0x0000000000000000000000000000000000000000"},58645:(e,t,a)=>{async function r(e){let[{getV1WalletsByWalletAddressTransactions:t},{getThirdwebDomains:r},{getClientFetch:n},{assertInsightEnabled:i},{stringify:s}]=await Promise.all([a.e(16285).then(a.bind(a,16285)),Promise.resolve().then(a.bind(a,17273)),Promise.resolve().then(a.bind(a,98864)),a.e(28318).then(a.bind(a,28318)),Promise.resolve().then(a.bind(a,8118))]);await i(e.chains);let o=Math.floor((Date.now()-7776e6)/1e3),{client:c,walletAddress:d,chains:m,queryOptions:p}=e,l={chain:m.map(e=>e.id),filter_block_timestamp_gte:o,limit:100},y=await t({baseUrl:`https://${r().insight}`,fetch:n(c),path:{wallet_address:d},query:{...l,...p}});if(y.error)throw Error(`${y.response.status} ${y.response.statusText} - ${y.error?s(y.error):"Unknown error"}`);return y.data.data||[]}a.d(t,{Kj:()=>o,kM:()=>c,U8:()=>s});var n=a(62759);let i=new Map;function s(e){let t=i.get(e);if(t)return t;let a=(0,n.y)([]);return i.set(e,a),a}function o(e){let{address:t,transactionHash:a,chainId:r}=e,n=s(t);n.setValue([...n.getValue(),{chainId:r,transactionHash:a}]),i.set(t,n)}async function c(e){let{walletAddress:t,chain:a,client:n}=e,i=Math.floor((Date.now()-2592e6)/1e3);return(await r({chains:[a],client:n,queryOptions:{filter_block_timestamp_gte:i,limit:20},walletAddress:t})).map(e=>({chainId:"string"==typeof e.chain_id?Number(e.chain_id):e.chain_id,receipt:{status:1===e.status?"success":"failed",to:e.to_address},transactionHash:e.hash}))}}}]);