"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[479],{70479:(e,s,t)=>{t.r(s),t.d(s,{default:()=>h});var a=t(95155),r=t(12115),l=t(28960),n=t(67695),i=t(15713),o=t(26784),c=t(6865),d=t(49112),m=t(98359),x=t(89629),u=t(45125);function h(){let e=(0,d.UD)(),{poolBalance:s,poolStats:t,isStaking:h,isUnstaking:p,getStakerInfo:y,stakeTokens:b,unstakeTokens:j,refetchPoolBalance:f,refetchPoolStats:N}=(0,m.hL)(),{getBalance:w,getAllowance:v,approveSpender:k,isApproving:S}=(0,m.Kp)(),[A,C]=(0,r.useState)(""),[F,U]=(0,r.useState)(""),[B,D]=(0,r.useState)("stake"),[P,I]=(0,r.useState)(null),[Y,L]=(0,r.useState)(BigInt(0)),[R,T]=(0,r.useState)(!1),[E,M]=(0,r.useState)(!0),[q,z]=(0,r.useState)(null),J="0x4f910ef3996d7C4763EFA2fEf15265e8b918cD0b".trim();(0,r.useEffect)(()=>{(async()=>{if(!e){I(null),M(!1);return}M(!0);try{let a=BigInt(0),r=null,l=BigInt(0);try{let s=await w(e);s&&(a=s)}catch(e){console.warn("Failed to fetch USDC balance:",e)}try{r=await y(e)}catch(e){console.warn("Failed to fetch staker info:",e)}try{console.log("Fetching allowance for:",{address:e,stakingPool:J,stakingPoolLength:J.length});let s=await v(e,J);null!=s&&(l=s),console.log("Allowance fetched successfully:",{allowance:null==s?void 0:s.toString(),currentAllowance:l.toString()})}catch(e){console.warn("Failed to fetch allowance:",e)}console.log("Pool stats received:",{poolBalance:null==s?void 0:s.toString(),poolStats:t,poolStatsType:typeof t,poolStatsLength:Array.isArray(t)?t.length:"not array"});let n={totalPoolBalance:(0,m.NJ)(s||BigInt(0),6),totalStakers:t&&Array.isArray(t)&&t.length>=2?Number(t[1]):0,totalRewards:(0,m.NJ)(t&&Array.isArray(t)&&t.length>=3?t[2]:BigInt(0),6),minimumStake:(0,m.NJ)(t&&Array.isArray(t)&&t.length>=4?t[3]:BigInt(1e6),6),userStaked:(0,m.NJ)((null==r?void 0:r.stakedAmount)||BigInt(0),6),userBalance:(0,m.NJ)(a,6)};console.log("Formatted stats:",n),I(n),L(l)}catch(e){console.error("Error fetching user data:",e),I({totalPoolBalance:"0",totalStakers:0,totalRewards:"0",minimumStake:"0",userStaked:"0",userBalance:"0"})}finally{M(!1)}})()},[e,s,t,w,y,v,J]),(0,r.useEffect)(()=>{A?T(Y<(0,m.t6)(A,6)):T(!1)},[A,Y]);let _=(0,r.useMemo)(()=>{if(!A||!P)return!1;let e=parseFloat(A),s=parseFloat(P.userBalance),t=parseFloat(P.minimumStake);return e>0&&e>=t&&e<=s},[A,P]),H=(0,r.useMemo)(()=>{if(!F||!P)return!1;let e=parseFloat(F),s=parseFloat(P.userStaked);return e>0&&e<=s},[F,P]),W=async()=>{if(A)try{let s=(0,m.t6)(A,6);await k(J,s),await new Promise(e=>setTimeout(e,1e3));let t=await v(e,J);L(t||BigInt(0)),console.log("Approval completed:",{approvedAmount:s.toString(),newAllowance:null==t?void 0:t.toString()}),z("approve"),setTimeout(()=>z(null),2e3)}catch(e){console.error("Approval failed:",e)}},X=async()=>{if(_&&A)try{let e=(0,m.t6)(A,6);await b(e),C(""),z("stake"),setTimeout(()=>z(null),2e3),await new Promise(e=>setTimeout(e,1500));try{await Promise.all([f(),N()])}catch(e){console.warn("Failed to refresh data after staking:",e)}}catch(e){console.error("Staking failed:",e)}},K=async()=>{if(H&&F)try{let e=(0,m.t6)(F,6);await j(e),U(""),await Promise.all([f(),N()])}catch(e){console.error("Unstaking failed:",e)}};return e?(0,a.jsxs)("div",{className:"max-w-4xl mx-auto p-6",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Staking Pool"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Stake USDC to fund quest rewards and support the community"})]}),E?(0,a.jsx)("div",{className:"flex justify-center py-12",children:(0,a.jsx)(u.Ay,{size:"lg"})}):(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-card border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center mb-6",children:[(0,a.jsx)(l.A,{className:"h-6 w-6 text-primary-600 mr-3"}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Pool Statistics"}),E&&(0,a.jsx)("div",{className:"ml-auto",children:(0,a.jsx)(u.Ay,{size:"sm"})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(g,{label:"Total Pool Balance",value:"".concat((null==P?void 0:P.totalPoolBalance)||"0"," USDC"),icon:(0,a.jsx)("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),isLoading:E}),(0,a.jsx)(g,{label:"Total Stakers",value:(null==P?void 0:P.totalStakers.toString())||"0",icon:(0,a.jsx)("div",{className:"w-2 h-2 bg-blue-400 rounded-full"}),isLoading:E}),(0,a.jsx)(g,{label:"Rewards Distributed",value:"".concat((null==P?void 0:P.totalRewards)||"0"," USDC"),icon:(0,a.jsx)("div",{className:"w-2 h-2 bg-purple-400 rounded-full"}),isLoading:E}),(0,a.jsx)(g,{label:"Minimum Stake",value:"".concat((null==P?void 0:P.minimumStake)||"0"," USDC"),icon:(0,a.jsx)(n.A,{className:"h-4 w-4 text-gray-400"}),isLoading:E})]}),P&&(0,a.jsxs)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"Your Position"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(g,{label:"Your Stake",value:"".concat(P.userStaked," USDC"),highlight:parseFloat(P.userStaked)>0,isLoading:E}),(0,a.jsx)(g,{label:"Available Balance",value:"".concat(P.userBalance," USDC"),isLoading:E})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-card border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex mb-6",children:[(0,a.jsxs)("button",{onClick:()=>D("stake"),className:"flex-1 py-3 px-4 text-center font-medium rounded-l-lg border-2 transition-colors ".concat("stake"===B?"bg-primary-50 text-primary-700 border-primary-200":"bg-gray-50 text-gray-600 border-gray-200 hover:bg-gray-100"),children:[(0,a.jsx)(i.A,{className:"h-4 w-4 inline mr-2"}),"Stake"]}),(0,a.jsxs)("button",{onClick:()=>D("unstake"),className:"flex-1 py-3 px-4 text-center font-medium rounded-r-lg border-2 border-l-0 transition-colors ".concat("unstake"===B?"bg-primary-50 text-primary-700 border-primary-200":"bg-gray-50 text-gray-600 border-gray-200 hover:bg-gray-100"),children:[(0,a.jsx)(o.A,{className:"h-4 w-4 inline mr-2"}),"Unstake"]})]}),"stake"===B&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount to Stake (USDC)"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"number",value:A,onChange:e=>C(e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 pr-20",placeholder:"0.00",min:"0",step:"0.01"}),(0,a.jsx)("button",{onClick:()=>{P&&C(P.userBalance)},className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-sm text-primary-600 hover:text-primary-800 font-medium",children:"MAX"})]}),P&&A&&(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Available: ",P.userBalance," USDC | Minimum: ",P.minimumStake," USDC"]})]}),A&&P&&(0,a.jsxs)("div",{className:"text-sm",children:[parseFloat(A)>parseFloat(P.userBalance)&&(0,a.jsxs)("p",{className:"text-red-600 flex items-center",children:[(0,a.jsx)(n.A,{className:"h-4 w-4 mr-1"}),"Insufficient balance"]}),parseFloat(A)<parseFloat(P.minimumStake)&&parseFloat(A)>0&&(0,a.jsxs)("p",{className:"text-yellow-600 flex items-center",children:[(0,a.jsx)(n.A,{className:"h-4 w-4 mr-1"}),"Below minimum stake amount"]}),_&&(0,a.jsxs)("p",{className:"text-green-600 flex items-center",children:[(0,a.jsx)(c.A,{className:"h-4 w-4 mr-1"}),"Ready to stake"]})]}),R&&(0,a.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:(0,a.jsxs)("div",{className:"flex items-start",children:[(0,a.jsx)(n.A,{className:"h-4 w-4 text-blue-600 mt-0.5 mr-2 flex-shrink-0"}),(0,a.jsxs)("div",{className:"text-xs text-blue-800",children:[(0,a.jsx)("p",{className:"font-medium",children:"Approval Required:"}),(0,a.jsx)("p",{children:"You need to approve the contract to spend your USDC tokens first."})]})]})}),!R&&A&&Y>BigInt(0)&&(0,a.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3 mb-4",children:(0,a.jsxs)("div",{className:"flex items-start",children:[(0,a.jsx)(c.A,{className:"h-4 w-4 text-green-600 mt-0.5 mr-2 flex-shrink-0"}),(0,a.jsxs)("div",{className:"text-xs text-green-800",children:[(0,a.jsx)("p",{className:"font-medium",children:"Ready to Stake:"}),(0,a.jsx)("p",{children:"Your approval is sufficient. You can now stake your tokens."})]})]})}),(0,a.jsxs)("div",{className:"space-y-3",children:[R&&(0,a.jsx)("button",{onClick:W,disabled:!_||S,className:"w-full bg-yellow-600 hover:bg-yellow-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-medium py-3 px-4 rounded-lg transition-colors flex items-center justify-center",children:S?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.Ay,{size:"sm",className:"mr-2"}),"Processing Transaction..."]}):"approve"===q?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.A,{className:"h-4 w-4 mr-2"}),"Approved Successfully!"]}):"Approve ".concat(A," USDC")}),(0,a.jsx)("button",{onClick:X,disabled:!_||R||h,className:"w-full bg-primary-600 hover:bg-primary-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-medium py-3 px-4 rounded-lg transition-colors flex items-center justify-center",children:h?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.Ay,{size:"sm",className:"mr-2"}),"Processing Transaction..."]}):"stake"===q?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.A,{className:"h-4 w-4 mr-2"}),"Staked Successfully!"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.A,{className:"h-4 w-4 mr-2"}),"Stake USDC"]})})]})]}),"unstake"===B&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount to Unstake (USDC)"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"number",value:F,onChange:e=>U(e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 pr-20",placeholder:"0.00",min:"0",step:"0.01"}),(0,a.jsx)("button",{onClick:()=>{P&&U(P.userStaked)},className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-sm text-primary-600 hover:text-primary-800 font-medium",children:"MAX"})]}),P&&(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Your stake: ",P.userStaked," USDC"]})]}),F&&P&&(0,a.jsxs)("div",{className:"text-sm",children:[parseFloat(F)>parseFloat(P.userStaked)&&(0,a.jsxs)("p",{className:"text-red-600 flex items-center",children:[(0,a.jsx)(n.A,{className:"h-4 w-4 mr-1"}),"Amount exceeds your stake"]}),H&&(0,a.jsxs)("p",{className:"text-green-600 flex items-center",children:[(0,a.jsx)(c.A,{className:"h-4 w-4 mr-1"}),"Ready to unstake"]})]}),(0,a.jsx)("button",{onClick:K,disabled:!H||p,className:"w-full bg-red-600 hover:bg-red-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-medium py-3 px-4 rounded-lg transition-colors flex items-center justify-center",children:p?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.Ay,{size:"sm",className:"mr-2"}),"Unstaking..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.A,{className:"h-4 w-4 mr-2"}),"Unstake USDC"]})}),(0,a.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex items-start",children:[(0,a.jsx)(n.A,{className:"h-5 w-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),(0,a.jsxs)("div",{className:"text-sm text-blue-800",children:[(0,a.jsx)("p",{className:"font-medium mb-1",children:"Instant Unstaking"}),(0,a.jsx)("p",{children:"You can unstake your tokens at any time without penalties. Unstaked tokens will be returned to your wallet immediately."})]})]})})]})]})]}),(0,a.jsxs)("div",{className:"mt-12 bg-gradient-to-r from-primary-50 to-secondary-50 rounded-xl p-8",children:[(0,a.jsx)("h3",{className:"text-2xl font-semibold text-gray-900 mb-6 text-center",children:"How Staking Works"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-primary-600 rounded-full flex items-center justify-center text-white font-bold text-lg mx-auto mb-4",children:"1"}),(0,a.jsx)("h4",{className:"font-semibold text-gray-900 mb-2",children:"Stake USDC"}),(0,a.jsx)("p",{className:"text-gray-600 text-sm",children:"Deposit USDC tokens into the shared pool to fund quest rewards"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-primary-600 rounded-full flex items-center justify-center text-white font-bold text-lg mx-auto mb-4",children:"2"}),(0,a.jsx)("h4",{className:"font-semibold text-gray-900 mb-2",children:"Fund Rewards"}),(0,a.jsx)("p",{className:"text-gray-600 text-sm",children:"Your staked tokens fund rewards for players completing quests"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-primary-600 rounded-full flex items-center justify-center text-white font-bold text-lg mx-auto mb-4",children:"3"}),(0,a.jsx)("h4",{className:"font-semibold text-gray-900 mb-2",children:"Support Community"}),(0,a.jsx)("p",{className:"text-gray-600 text-sm",children:"Help grow the ecosystem and enable more quest opportunities"})]})]}),(0,a.jsx)("div",{className:"mt-8 text-center",children:(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,a.jsx)("strong",{children:"Note:"})," Staking helps fund community rewards. You can unstake at any time without penalties. Future versions may include staking rewards."]})})]})]}):(0,a.jsxs)("div",{className:"max-w-md mx-auto p-6 bg-white rounded-lg shadow-sm border border-gray-200 text-center",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Connect Your Wallet"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"Connect your wallet to access staking features"}),(0,a.jsx)(x.Ay,{variant:"default"})]})}function g(e){let{label:s,value:t,icon:r,highlight:l=!1,isLoading:n=!1}=e;return(0,a.jsxs)("div",{className:"flex items-center justify-between py-2",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[r&&(0,a.jsx)("span",{className:"mr-2",children:r}),(0,a.jsx)("span",{className:"text-sm text-gray-600",children:s})]}),n?(0,a.jsx)("div",{className:"w-16 h-4 bg-gray-200 rounded animate-pulse"}):(0,a.jsx)("span",{className:"font-semibold ".concat(l?"text-primary-600":"text-gray-900"),children:t})]})}}}]);