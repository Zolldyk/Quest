"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[11220],{11220:(e,a,t)=>{t.d(a,{connectSmartAccount:()=>eD,disconnectSmartAccount:()=>eb});var r=t(39696),i=t(55389),n=t(23802),s=t(2579),o=t(26489);let c=[{name:"owner",type:"address"},{name:"spender",type:"address"}],d=[{type:"uint256"}];async function m(e){return(0,o.readContract)({contract:e.contract,method:["0xdd62ed3e",c,d],params:[e.owner,e.spender]})}var p=t(19131),y=t(3702),l=t(66971);let u=[{name:"spender",type:"address"},{name:"value",type:"uint256"}],f=[{type:"bool"}];var v=t(58528),w=t(49386);let h=[{name:"signer",type:"address"}],G=[{components:[{name:"signer",type:"address"},{name:"approvedTargets",type:"address[]"},{name:"nativeTokenLimitPerTransaction",type:"uint256"},{name:"startTimestamp",type:"uint128"},{name:"endTimestamp",type:"uint128"}],name:"permissions",type:"tuple"}];async function g(e){return(0,o.readContract)({contract:e.contract,method:["0xf15d424e",h,G],params:[e.signer]})}let A=[{components:[{name:"signer",type:"address"},{name:"isAdmin",type:"uint8"},{name:"approvedTargets",type:"address[]"},{name:"nativeTokenLimitPerTransaction",type:"uint256"},{name:"permissionStartTimestamp",type:"uint128"},{name:"permissionEndTimestamp",type:"uint128"},{name:"reqValidityStartTimestamp",type:"uint128"},{name:"reqValidityEndTimestamp",type:"uint128"},{name:"uid",type:"bytes32"}],name:"req",type:"tuple"},{name:"signature",type:"bytes"}],L=[];var P=t(40651);function T(){return new Date(Date.now()+31536e7)}function x(e){return(0,P.Dg)(Math.floor(e.getTime()/1e3))}var V=t(25955);let O=[{name:"signer",type:"address"},{name:"isAdmin",type:"uint8"},{name:"approvedTargets",type:"address[]"},{name:"nativeTokenLimitPerTransaction",type:"uint256"},{name:"permissionStartTimestamp",type:"uint128"},{name:"permissionEndTimestamp",type:"uint128"},{name:"reqValidityStartTimestamp",type:"uint128"},{name:"reqValidityEndTimestamp",type:"uint128"},{name:"uid",type:"bytes32"}];async function D(e){let{account:a,contract:t,req:r}=e,i=await a.signTypedData({domain:{chainId:t.chain.id,name:"Account",verifyingContract:t.address,version:"1"},message:r,primaryType:"SignerPermissionRequest",types:{SignerPermissionRequest:O}});return{req:r,signature:i}}async function b(e){let{target:a,permissions:t}=e;return{approvedTargets:"*"===t.approvedTargets?[v.cF]:t.approvedTargets,isAdmin:0,nativeTokenLimitPerTransaction:(0,p.fq)(t.nativeTokenLimitPerTransaction?.toString()||"0"),permissionEndTimestamp:x(t.permissionEndTimestamp||T()),permissionStartTimestamp:x(t.permissionStartTimestamp||new Date(0)),reqValidityEndTimestamp:x(T()),reqValidityStartTimestamp:0n,signer:a,uid:await (0,V.O)()}}async function C(e){var a,t;let{accountContract:r,sessionKeyAddress:i,newPermissions:n}=e;if(!await (0,w.isContractDeployed)(r))return!0;let s=await g({contract:r,signer:i});return!!(s.endTimestamp&&s.endTimestamp<Math.floor(Date.now()/1e3)||(a=s.approvedTargets,!("*"===(t=n.approvedTargets)&&1===a.length&&a[0]===v.cF||"*"!==t&&t.map(e=>e.toLowerCase()).every(e=>a.map(e=>e.toLowerCase()).includes(e))))||(0,p.fq)(n.nativeTokenLimitPerTransaction?.toString()??"0")>s.nativeTokenLimitPerTransaction)}var k=t(23316),I=t(81647),F=t(99134),E=t(99232),S=t(67316),q=t(94),$=t(94879);let M=2n**96n-1n;var B=t(40633),U=t(54500),H=t(14408),z=t(40310),j=t(48624);let W=[{name:"sender",type:"address"},{name:"key",type:"uint192"}],K=[{name:"nonce",type:"uint256"}];async function R(e){return(0,o.readContract)({contract:e.contract,method:["0x35567e1a",W,K],params:[e.sender,e.key]})}let N=[{components:[{name:"sender",type:"address"},{name:"nonce",type:"uint256"},{name:"initCode",type:"bytes"},{name:"callData",type:"bytes"},{name:"callGasLimit",type:"uint256"},{name:"verificationGasLimit",type:"uint256"},{name:"preVerificationGas",type:"uint256"},{name:"maxFeePerGas",type:"uint256"},{name:"maxPriorityFeePerGas",type:"uint256"},{name:"paymasterAndData",type:"bytes"},{name:"signature",type:"bytes"}],name:"userOp",type:"tuple"}],Y=[{type:"bytes32"}];async function _(e){return(0,o.readContract)({contract:e.contract,method:["0xa6193531",N,Y],params:[e.userOp]})}let Q=[{components:[{name:"sender",type:"address"},{name:"nonce",type:"uint256"},{name:"initCode",type:"bytes"},{name:"callData",type:"bytes"},{name:"accountGasLimits",type:"bytes32"},{name:"preVerificationGas",type:"uint256"},{name:"gasFees",type:"bytes32"},{name:"paymasterAndData",type:"bytes"},{name:"signature",type:"bytes"}],name:"userOp",type:"tuple"}],J=[{type:"bytes32"}];async function Z(e){return(0,o.readContract)({contract:e.contract,method:["0x22cdde4c",Q,J],params:[e.userOp]})}var X=t(66043),ee=t(8121),ea=t(33267),et=t(23471),er=t(95821),ei=t(98864),en=t(43324),es=t(8118),eo=t(15693),ec=t(99443),ed=t(72556);async function em(e){let{userOp:a,paymasterOverride:t,client:r,chain:i,entrypointAddress:n}=e;if(t)return t(a);let s=n??H.uh,o=(0,H.RZ)(i),c={id:1,jsonrpc:"2.0",method:"pm_sponsorUserOperation",params:[(0,ed.K)(a),s]},d=(0,ei.getClientFetch)(r),m=await d(o,{body:(0,es.stringify)(c),headers:{"Content-Type":"application/json"},method:"POST"});if(!m.ok){let e=await m.text()||m.statusText;throw Error(`Paymaster error: ${m.status} - ${e}`)}let p=await m.json();if(p.result)return"string"==typeof p.result?{paymasterAndData:p.result}:(p.result.reason&&console.warn(`Paymaster policy rejected this transaction with reason: ${p.result.reason} ${p.result.policyId?`(policyId: ${p.result.policyId})`:""}`),{callGasLimit:p.result.callGasLimit?(0,et.uU)(p.result.callGasLimit):void 0,paymaster:p.result.paymaster,paymasterAndData:p.result.paymasterAndData,paymasterData:p.result.paymasterData,paymasterPostOpGasLimit:p.result.paymasterPostOpGasLimit?(0,et.uU)(p.result.paymasterPostOpGasLimit):void 0,paymasterVerificationGasLimit:p.result.paymasterVerificationGasLimit?(0,et.uU)(p.result.paymasterVerificationGasLimit):void 0,preVerificationGas:p.result.preVerificationGas?(0,et.uU)(p.result.preVerificationGas):void 0,verificationGasLimit:p.result.verificationGasLimit?(0,et.uU)(p.result.verificationGasLimit):void 0});let y=p.error?.message||p.error||m.statusText||"unknown error";throw Error(`Paymaster error from ${o}: ${y}`)}let ep=new Set,ey=e=>`${e.chain.id}:${e.address}`,el=e=>{ep.add(ey(e))},eu=e=>{ep.delete(ey(e))},ef=e=>ep.has(ey(e));async function ev(e){let a=e.timeoutMs||12e4,t=e.intervalMs||1e3,r=Date.now()+a;for(;Date.now()<r;){let a=await (0,B.JI)(e);if(a)return a;await new Promise(e=>setTimeout(e,t))}throw Error(`Timeout waiting for userOp to be mined on chain ${e.chain.id} with UserOp hash: ${e.userOpHash}`)}async function ew(e){let{transaction:a,accountContract:t,factoryContract:r,adminAddress:i,overrides:n,sponsorGas:s,waitForDeployment:o=!0,isDeployedOverride:c}=e,d=a.chain,m=a.client,p={bundlerUrl:n?.bundlerUrl,chain:d,client:m,entrypointAddress:n?.entrypointAddress},y=(0,H.Fn)(e.overrides?.entrypointAddress||H.uh),[l,u,f,v,h]=await Promise.all(["boolean"==typeof c?c:(0,w.isContractDeployed)(t).then(e=>e||ef(t)),(0,ee.encode)(a),(0,q.r)(a.gas),eh({bundlerOptions:p,chain:d,client:m,executeTx:a}),eT({accountContract:t,chain:d,client:m,entrypointAddress:n?.entrypointAddress,getNonceOverride:n?.getAccountNonce})]),{maxFeePerGas:G,maxPriorityFeePerGas:g}=v;return"v0.7"===y?eG({accountContract:t,adminAddress:i,bundlerOptions:p,callData:u,callGasLimit:f,factoryContract:r,isDeployed:l,maxFeePerGas:G,maxPriorityFeePerGas:g,nonce:h,overrides:n,sponsorGas:s,waitForDeployment:o}):eg({accountContract:t,adminAddress:i,bundlerOptions:p,callData:u,callGasLimit:f,factoryContract:r,isDeployed:l,maxFeePerGas:G,maxPriorityFeePerGas:g,nonce:h,overrides:n,sponsorGas:s,waitForDeployment:o})}async function eh(e){let{executeTx:a,bundlerOptions:t,chain:r,client:i}=e,{maxFeePerGas:n,maxPriorityFeePerGas:s}=a,o=t?.bundlerUrl??(0,H.RZ)(r);if((0,ei.isThirdwebUrl)(o)){let e=await (0,B.fB)({options:t});n=e.maxFeePerGas,s=e.maxPriorityFeePerGas}else{let[e,a]=await Promise.all([(0,q.r)(n),(0,q.r)(s)]);if(e&&a)n=e,s=a;else{let t=await (0,X.G)(i,r);s=a??t.maxPriorityFeePerGas??0n,n=e??t.maxFeePerGas??0n}}return{maxFeePerGas:n,maxPriorityFeePerGas:s}}async function eG(e){let a,t,{bundlerOptions:r,isDeployed:i,factoryContract:n,accountContract:s,adminAddress:o,sponsorGas:c,overrides:d,nonce:m,callData:p,callGasLimit:y,maxFeePerGas:l,maxPriorityFeePerGas:u,waitForDeployment:f}=e,{chain:v,client:w}=r;i?(t="0x",f&&await ex(s)):(a=n.address,t=await (0,ee.encode)((0,U.HM)({accountSalt:d?.accountSalt,adminAddress:o,createAccountOverride:d?.createAccount,factoryContract:n})),f&&el(s));let h={callData:p,callGasLimit:y??0n,factory:a,factoryData:t,maxFeePerGas:l,maxPriorityFeePerGas:u,nonce:m,paymaster:void 0,paymasterData:"0x",paymasterPostOpGasLimit:0n,paymasterVerificationGasLimit:0n,preVerificationGas:0n,sender:s.address,signature:H.km,verificationGasLimit:0n};if(c){let e=await em({chain:v,client:w,entrypointAddress:d?.entrypointAddress,paymasterOverride:d?.paymaster,userOp:h});if(e.paymaster&&e.paymasterData&&(h.paymaster=e.paymaster,h.paymasterData=e.paymasterData),e.callGasLimit&&e.verificationGasLimit&&e.preVerificationGas&&e.paymasterPostOpGasLimit&&e.paymasterVerificationGasLimit)h.callGasLimit=e.callGasLimit,h.verificationGasLimit=e.verificationGasLimit,h.preVerificationGas=e.preVerificationGas,h.paymasterPostOpGasLimit=e.paymasterPostOpGasLimit,h.paymasterVerificationGasLimit=e.paymasterVerificationGasLimit;else{let e=d?.tokenPaymaster?{[d.tokenPaymaster.tokenAddress]:{stateDiff:{[(0,en.S)((0,ea.hd)([{type:"address"},{type:"uint256"}],[s.address,d.tokenPaymaster.balanceStorageSlot]))]:(0,et.nj)(z.EA,{size:32})}}}:void 0,a=await (0,B.yY)({options:r,userOp:h},e);h.callGasLimit=a.callGasLimit,h.verificationGasLimit=a.verificationGasLimit,h.preVerificationGas=a.preVerificationGas,h.paymasterPostOpGasLimit=d?.tokenPaymaster?500000n:a.paymasterPostOpGasLimit||0n,h.paymasterVerificationGasLimit=a.paymasterVerificationGasLimit||0n;let t=await em({chain:v,client:w,entrypointAddress:d?.entrypointAddress,paymasterOverride:d?.paymaster,userOp:h});t.paymaster&&t.paymasterData&&(h.paymaster=t.paymaster,h.paymasterData=t.paymasterData)}}else{let e=await (0,B.yY)({options:r,userOp:h});h.callGasLimit=e.callGasLimit,h.verificationGasLimit=e.verificationGasLimit,h.preVerificationGas=e.preVerificationGas,h.paymasterPostOpGasLimit=e.paymasterPostOpGasLimit||0n,h.paymasterVerificationGasLimit=e.paymasterVerificationGasLimit||0n}return{...h,signature:"0x"}}async function eg(e){let a,{bundlerOptions:t,isDeployed:r,factoryContract:i,accountContract:n,adminAddress:s,sponsorGas:o,overrides:c,nonce:d,callData:m,callGasLimit:p,maxFeePerGas:y,maxPriorityFeePerGas:l,waitForDeployment:u}=e,{chain:f,client:v}=t;r?(a="0x",u&&await ex(n)):(a=await eP({accountSalt:c?.accountSalt,adminAddress:s,createAccountOverride:c?.createAccount,factoryContract:i}),u&&el(n));let w={callData:m,callGasLimit:p??0n,initCode:a,maxFeePerGas:y,maxPriorityFeePerGas:l,nonce:d,paymasterAndData:"0x",preVerificationGas:0n,sender:n.address,signature:H.km,verificationGasLimit:0n};if(o){let e=await em({chain:f,client:v,entrypointAddress:c?.entrypointAddress,paymasterOverride:c?.paymaster,userOp:w}),a="paymasterAndData"in e?e.paymasterAndData:"0x";if(a&&"0x"!==a&&(w.paymasterAndData=a),e.callGasLimit&&e.verificationGasLimit&&e.preVerificationGas)w.callGasLimit=e.callGasLimit,w.verificationGasLimit=e.verificationGasLimit,w.preVerificationGas=e.preVerificationGas;else{let e=await (0,B.yY)({options:t,userOp:w});if(w.callGasLimit=e.callGasLimit,w.verificationGasLimit=e.verificationGasLimit,w.preVerificationGas=e.preVerificationGas,a&&"0x"!==a){let e=await em({chain:f,client:v,entrypointAddress:c?.entrypointAddress,paymasterOverride:c?.paymaster,userOp:w}),a="paymasterAndData"in e?e.paymasterAndData:"0x";a&&"0x"!==a&&(w.paymasterAndData=a)}}}else{let e=await (0,B.yY)({options:t,userOp:w});w.callGasLimit=e.callGasLimit,w.verificationGasLimit=e.verificationGasLimit,w.preVerificationGas=e.preVerificationGas}return{...w,signature:"0x"}}async function eA(e){let{userOp:a,chain:t,entrypointAddress:r,adminAccount:i}=e,n=await eL({chain:t,client:e.client,entrypointAddress:r,userOp:a});if(i.signMessage){let e=await i.signMessage({chainId:t.id,message:{raw:(0,er.aT)(n)},originalMessage:(0,es.stringify)(a)});return{...a,signature:e}}throw Error("signMessage not implemented in signingAccount")}async function eL(e){let a,{userOp:t,chain:r,entrypointAddress:i}=e;if("v0.7"===(0,H.Fn)(i||H.uh)){let n={accountGasLimits:(0,j.xW)([(0,eo.eV)((0,ec.nj)(BigInt(t.verificationGasLimit)),{size:16}),(0,eo.eV)((0,ec.nj)(BigInt(t.callGasLimit)),{size:16})]),callData:t.callData,gasFees:(0,j.xW)([(0,eo.eV)((0,ec.nj)(BigInt(t.maxPriorityFeePerGas)),{size:16}),(0,eo.eV)((0,ec.nj)(BigInt(t.maxFeePerGas)),{size:16})]),initCode:t.factory?(0,j.xW)([t.factory,t.factoryData||"0x"]):"0x",nonce:BigInt(t.nonce),paymasterAndData:t.paymaster?(0,j.xW)([t.paymaster,(0,eo.eV)((0,ec.nj)(BigInt(t.paymasterVerificationGasLimit||0)),{size:16}),(0,eo.eV)((0,ec.nj)(BigInt(t.paymasterPostOpGasLimit||0)),{size:16}),t.paymasterData||"0x"]):"0x",preVerificationGas:BigInt(t.preVerificationGas),sender:t.sender,signature:t.signature};a=await Z({contract:(0,s.P)({address:i||H.nF,chain:r,client:e.client}),userOp:n})}else a=await _({contract:(0,s.P)({address:i||H.uh,chain:r,client:e.client}),userOp:t});return a}async function eP(e){let{factoryContract:a,adminAddress:t,accountSalt:r,createAccountOverride:i}=e,n=(0,U.HM)({accountSalt:r,adminAddress:t,createAccountOverride:i,factoryContract:a});return(0,j.xW)([a.address,await (0,ee.encode)(n)])}async function eT(e){let{accountContract:a,chain:t,client:r,entrypointAddress:i,getNonceOverride:n}=e;return n?n(a):await R({contract:(0,s.P)({address:i||H.uh,chain:t,client:r}),key:(0,ed.t)(),sender:a.address})}async function ex(e){let a=Date.now();for(;ef(e);){if(Date.now()-a>6e4)throw eu(e),Error("Account deployment is taking too long (over 1 minute). Please try again.");await new Promise(e=>setTimeout(e,500))}}let eV=new WeakMap,eO=new WeakMap;async function eD(e,a){let{personalAccount:t,client:r}=e;if(!t)throw Error("No personal account provided for smart account connection");let o=a.chain,c="gasless"in a?a.gasless:a.sponsorGas;if(await (0,S.k)(o))return[function(e){let{creationOptions:a,connectionOptions:t,chain:r}=e,s={address:(0,E.bv)(t.personalAccount.address),onTransactionRequested:async e=>t.personalAccount.onTransactionRequested?.(e),async sendTransaction(o){let c={chain:(0,n.Q4)(o.chainId),client:t.client,data:o.data,eip712:o.eip712,to:o.to??void 0,value:o.value??0n},d=await (0,F.f)({account:s,transaction:c});if(e.sponsorGas&&!d.paymaster){let e=await (0,B.qq)({options:{bundlerUrl:a.overrides?.bundlerUrl,chain:r,client:t.client,entrypointAddress:a.overrides?.entrypointAddress},transaction:d});d={...d,...e}}let m=await (0,F.a)({account:s,chainId:r.id,eip712Transaction:d}),p=await (0,B.vx)({options:{bundlerUrl:a.overrides?.bundlerUrl,chain:r,client:t.client,entrypointAddress:a.overrides?.entrypointAddress},signedTransaction:m,transaction:d});return(0,i.E)({chainId:r.id,client:t.client,contractAddress:o.to??void 0,transactionHash:p.transactionHash,walletAddress:s.address,walletType:"smart"}),{chain:r,client:t.client,transactionHash:p.transactionHash}},signMessage:async({message:e})=>t.personalAccount.signMessage({message:e}),async signTypedData(e){let a=(0,$.y)(e);return t.personalAccount.signTypedData(a)}};return s}({chain:o,connectionOptions:e,creationOptions:a,sponsorGas:c}),o];if(a.factoryAddress&&!a.overrides?.entrypointAddress){let e=await eF(a.factoryAddress,r,o);e&&(a.overrides={...a.overrides,entrypointAddress:e})}a.overrides?.tokenPaymaster&&!a.overrides?.entrypointAddress&&(a.overrides={...a.overrides,entrypointAddress:H.nF});let d=a.factoryAddress??(0,H.Fd)(a.overrides?.entrypointAddress),m=(0,s.P)({address:d,chain:o,client:r}),p=await (0,U.Mi)({accountAddress:a.overrides?.accountAddress,accountSalt:a.overrides?.accountSalt,adminAddress:t.address,factoryContract:m,predictAddressOverride:a.overrides?.predictAddress}).then(e=>e).catch(e=>{throw Error(`Failed to get account address with factory contract ${m.address} on chain ID ${o.id}: ${e?.message||"unknown error"}`,{cause:e})}),u=(0,s.P)({address:p,chain:o,client:r}),f=await eC({...a,accountContract:u,chain:o,client:r,factoryContract:m,personalAccount:t,sponsorGas:c});if(eV.set(t,f),eO.set(f,t),a.sessionKey&&await C({accountContract:u,newPermissions:a.sessionKey.permissions,sessionKeyAddress:a.sessionKey.address})){let e=function(e){let{contract:a,sessionKeyAddress:t,account:r,permissions:i}=e;var n={async asyncParams(){let{req:e,signature:n}=await D({account:r,contract:a,req:await b({permissions:i,target:t})});return{req:e,signature:n}},contract:a};let s=(0,l.O)(async()=>"asyncParams"in n?await n.asyncParams():n);return(0,y.m)({accessList:async()=>(await s()).overrides?.accessList,authorizationList:async()=>(await s()).overrides?.authorizationList,contract:n.contract,erc20Value:async()=>(await s()).overrides?.erc20Value,extraGas:async()=>(await s()).overrides?.extraGas,gas:async()=>(await s()).overrides?.gas,gasPrice:async()=>(await s()).overrides?.gasPrice,maxFeePerGas:async()=>(await s()).overrides?.maxFeePerGas,maxPriorityFeePerGas:async()=>(await s()).overrides?.maxPriorityFeePerGas,method:["0x5892e236",A,L],nonce:async()=>(await s()).overrides?.nonce,params:async()=>{let e=await s();return[e.req,e.signature]},value:async()=>(await s()).overrides?.value})}({account:t,contract:u,permissions:a.sessionKey.permissions,sessionKeyAddress:a.sessionKey.address});await (0,k.sendTransaction)({account:f,transaction:e})}return[f,o]}async function eb(e){let a=eO.get(e);a&&(eV.delete(a),eO.delete(e))}async function eC(e){let a=e.overrides?.tokenPaymaster;if(a&&"v0.7"!==(0,H.Fn)(e.overrides?.entrypointAddress||H.uh))throw Error("Token paymaster is only supported for entrypoint version v0.7");let r=e.accountContract,o={address:(0,E.bv)(r.address),onTransactionRequested:async a=>e.personalAccount.onTransactionRequested?.(a),async sendBatchTransaction(a){let t=(0,U.zi)({accountContract:r,executeBatchOverride:e.overrides?.executeBatch,transactions:a});if(0===a.length)throw Error("No transactions to send");let s=a[0];if(!s)throw Error("No transactions to send");let o=(0,n.Q4)(s.chainId),c=await eI({executeTx:t,options:{...e,accountContract:r,chain:o}});return(0,i.E)({chainId:o.id,client:e.client,contractAddress:a[0]?.to??void 0,transactionHash:c.transactionHash,walletAddress:e.accountContract.address,walletType:"smart"}),c},async sendTransaction(t){let c;if(a){await ek({accountContract:r,erc20Paymaster:a,options:e});let t=async()=>({paymaster:a.paymasterAddress,paymasterData:"0x"});c=e.overrides?.paymaster||t}else c=e.overrides?.paymaster;t.chainId!==r.chain.id&&(r=(0,s.P)({address:o.address,chain:(0,n.Q4)(t.chainId),client:e.client}));let d=(0,U.Lc)({accountContract:r,executeOverride:e.overrides?.execute,transaction:t}),m=(0,n.Q4)(t.chainId),p=await eI({executeTx:d,options:{...e,accountContract:r,chain:m,overrides:{...e.overrides,paymaster:c}}});return(0,i.E)({chainId:m.id,client:e.client,contractAddress:t.to??void 0,transactionHash:p.transactionHash,walletAddress:e.accountContract.address,walletType:"smart"}),p},async signMessage({message:a}){if(e.overrides?.signMessage)return e.overrides.signMessage({accountContract:r,adminAccount:e.personalAccount,factoryContract:e.factoryContract,message:a});let{smartAccountSignMessage:i}=await Promise.all([t.e(15919),t.e(28835)]).then(t.bind(t,28835));return i({accountContract:r,factoryContract:e.factoryContract,message:a,options:e})},async signTypedData(a){if(e.overrides?.signTypedData)return e.overrides.signTypedData({accountContract:r,adminAccount:e.personalAccount,factoryContract:e.factoryContract,typedData:a});let{smartAccountSignTypedData:i}=await Promise.all([t.e(15919),t.e(28835)]).then(t.bind(t,28835));return i({accountContract:r,factoryContract:e.factoryContract,options:e,typedData:a})}};return o}async function ek(e){let{accountContract:a,erc20Paymaster:r,options:i}=e,n=r.tokenAddress,o=(0,s.P)({address:n,chain:a.chain,client:a.client});if(await m({contract:o,owner:a.address,spender:r.paymasterAddress})>0n)return;let c=function(e){var a={asyncParams:async()=>{let a;if("amount"in e){let{decimals:r}=await t.e(96491).then(t.bind(t,96491)),i=await r(e).catch(()=>18);a=(0,p.J1)(e.amount.toString(),i)}else a=e.amountWei;return{overrides:{erc20Value:{amountWei:a,tokenAddress:e.contract.address}},spender:e.spender,value:a}},contract:e.contract};let r=(0,l.O)(async()=>"asyncParams"in a?await a.asyncParams():a);return(0,y.m)({accessList:async()=>(await r()).overrides?.accessList,authorizationList:async()=>(await r()).overrides?.authorizationList,contract:a.contract,erc20Value:async()=>(await r()).overrides?.erc20Value,extraGas:async()=>(await r()).overrides?.extraGas,gas:async()=>(await r()).overrides?.gas,gasPrice:async()=>(await r()).overrides?.gasPrice,maxFeePerGas:async()=>(await r()).overrides?.maxFeePerGas,maxPriorityFeePerGas:async()=>(await r()).overrides?.maxPriorityFeePerGas,method:["0x095ea7b3",u,f],nonce:async()=>(await r()).overrides?.nonce,params:async()=>{let e=await r();return[e.spender,e.value]},value:async()=>(await r()).overrides?.value})}({amountWei:M-1n,contract:o,spender:r.paymasterAddress}),d=await (0,I.$)({from:a.address,transaction:c}),v=(0,U.Lc)({accountContract:a,executeOverride:i.overrides?.execute,transaction:d});await eI({executeTx:v,options:{...i,overrides:{...i.overrides,tokenPaymaster:void 0}}})}async function eI(e){let{executeTx:a,options:t}=e;try{let e=await ew({accountContract:t.accountContract,adminAddress:t.personalAccount.address,factoryContract:t.factoryContract,overrides:t.overrides,sponsorGas:t.sponsorGas,transaction:a}),r=await eA({adminAccount:t.personalAccount,chain:t.chain,client:t.client,entrypointAddress:t.overrides?.entrypointAddress,userOp:e}),n={bundlerUrl:t.overrides?.bundlerUrl,chain:t.chain,client:t.client,entrypointAddress:t.overrides?.entrypointAddress},s=await (0,B.Ro)({options:n,userOp:r}),o=await ev({...n,userOpHash:s});return(0,i.E)({chainId:t.chain.id,client:t.client,contractAddress:await (0,q.r)(a.to??void 0),transactionHash:o.transactionHash,walletAddress:t.accountContract.address,walletType:"smart"}),{chain:t.chain,client:t.client,transactionHash:o.transactionHash}}catch(e){throw(0,r.Y)(e)&&(0,i.z)({chainId:t.chain.id,client:t.client,contractAddress:await (0,q.r)(a.to??void 0),error:e,transactionValue:await (0,q.r)(a.value),walletAddress:t.accountContract.address}),e}finally{eu(t.accountContract)}}async function eF(e,a,t){let r=(0,s.P)({address:e,chain:t,client:a});try{return await (0,o.readContract)({contract:r,method:"function entrypoint() public view returns (address)"})}catch{return}}},54500:(e,a,t)=>{t.d(a,{HM:()=>d,Lc:()=>m,Mi:()=>c,zi:()=>p});var r=t(3702),i=t(26489),n=t(53360),s=t(23471),o=t(72980);async function c(e){let{factoryContract:a,predictAddressOverride:t,adminAddress:r,accountSalt:c,accountAddress:d}=e;if(t)return t(a,r);if(d)return d;if(!r)throw Error("Account address is required to predict the smart wallet address.");return(0,o.n)(async()=>{let e,t=c&&(0,n.q)(c)?c:(0,s.i3)(c??""),o=0;for(;o<=3;)try{e=await (0,i.readContract)({contract:a,method:"function getAddress(address, bytes) returns (address)",params:[r,t]});break}catch(a){if(3===o)throw a;let e=2**(o+1)*200;await new Promise(a=>setTimeout(a,e)),o++}if(!e)throw Error(`No smart account address found for admin address ${r} and salt ${c}`);return e},{cacheKey:`${e.factoryContract.chain.id}-${e.factoryContract.address}-${e.adminAddress}-${e.accountSalt}`,cacheTime:864e5})}function d(e){let{adminAddress:a,factoryContract:t,createAccountOverride:i,accountSalt:o}=e;if(i)return i(t,a);let c=o&&(0,n.q)(o)?o:(0,s.i3)(o??"");return(0,r.m)({contract:t,method:"function createAccount(address, bytes) returns (address)",params:[a,c]})}function m(e){let{accountContract:a,transaction:t,executeOverride:i}=e;if(i)return i(a,t);let n=t.value||0n;return(295===t.chainId||296===t.chainId)&&(n=BigInt(n)/BigInt(1e10)),(0,r.m)({contract:a,gas:t.gas?t.gas+21000n:void 0,method:"function execute(address, uint256, bytes)",params:[t.to||"",n,t.data||"0x"]})}function p(e){let{accountContract:a,transactions:t,executeBatchOverride:i}=e;if(i)return i(a,t);let n=t.map(e=>e.value||0n),s=t[0]?.chainId;return(295===s||296===s)&&(n=n.map(e=>BigInt(e)/BigInt(1e10))),(0,r.m)({contract:a,method:"function executeBatch(address[], uint256[], bytes[])",params:[t.map(e=>e.to||""),n,t.map(e=>e.data||"0x")]})}}}]);