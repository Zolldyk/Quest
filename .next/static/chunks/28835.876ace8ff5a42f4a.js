"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[28835],{28835:(e,t,r)=>{r.d(t,{smartAccountSignMessage:()=>w,smartAccountSignTypedData:()=>A});var a=r(33267),n=r(3348);function s({address:e,data:t,signature:r}){return(0,n.concatHex)([(0,a.hd)([{type:"address"},{type:"bytes"},{type:"bytes"}],[e,t,r]),"0x6492649264926492649264926492649264926492649264926492649264926492"])}var o=r(26489);let i=[{name:"hash",type:"bytes32"},{name:"signature",type:"bytes"}],c=[{type:"bytes4"}];async function d(e){return(0,o.readContract)({contract:e.contract,method:["0x1626ba7e",i,c],params:[e.hash,e.signature]})}async function u({hash:e,signature:t,contract:r}){try{return await d({contract:r,hash:e,signature:t})==="0x1626ba7e"}catch(e){return console.error("Error verifying EIP-1271 signature",e),!1}}var y=r(8121),p=r(49386),l=r(52866),f=r(95821),m=r(43324),h=r(15919),g=r(23471),v=r(54500);async function w({accountContract:e,factoryContract:t,options:r,message:n}){let o,i=function(e,t){let r="string"==typeof e?(0,f.Af)(e):e.raw instanceof Uint8Array?e.raw:(0,f.ZJ)(e.raw),a=(0,f.Af)(`\x19Ethereum Signed Message:
${r.length}`);return(0,m.S)(l.xW(a,r),void 0)}(n),c=(0,a.hd)([{type:"bytes32"}],[i]);if(o=await r.personalAccount.signTypedData({domain:{chainId:r.chain.id,name:"Account",verifyingContract:e.address,version:"1"},message:{message:c},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]}}),await (0,p.isContractDeployed)(e)){if(await u({contract:e,hash:i,signature:o}))return o;throw Error("Failed to verify signature")}{let e=(0,v.HM)({accountSalt:r.overrides?.accountSalt,adminAddress:r.personalAccount.address,createAccountOverride:r.overrides?.createAccount,factoryContract:t});if(!e)throw Error("Create account override not provided");let a=await (0,y.encode)(e);return s({address:t.address,data:a,signature:o})}}async function A({accountContract:e,factoryContract:t,options:r,typedData:n}){let o;if(n.domain?.verifyingContract?.toLowerCase()===e.address?.toLowerCase())return r.personalAccount.signTypedData(n);let i=function(e){let{domain:t={},message:r,primaryType:n}=e,s={EIP712Domain:h.HQ(t),...e.types};h.tf({domain:t,message:r,primaryType:n,types:s});let o=["0x1901"];if(t&&o.push(h.xy({domain:t,types:s})),"EIP712Domain"!==n){let e=(()=>{let e=function e({data:t,primaryType:r,types:n}){let s=[{type:"bytes32"}],o=[function({primaryType:e,types:t}){let r=(0,g.nj)(function({primaryType:e,types:t}){let r="",a=function e({primaryType:t,types:r},a=new Set){let n=t.match(/^\w*/u),s=n?.[0];if(a.has(s)||void 0===r[s])return a;for(let t of(a.add(s),r[s]))e({primaryType:t.type,types:r},a);return a}({primaryType:e,types:t});for(let n of(a.delete(e),[e,...Array.from(a).sort()])){if(!t[n])throw Error("Invalid types");r+=`${n}(${t[n].map(({name:e,type:t})=>`${t} ${e}`).join(",")})`}return r}({primaryType:e,types:t}));return(0,m.S)(r)}({primaryType:r,types:n})];if(!n[r])throw Error("Invalid types");for(let i of n[r]){let[r,c]=function t({types:r,name:n,type:s,value:o}){if(void 0!==r[s])return[{type:"bytes32"},(0,m.S)(e({data:o,primaryType:s,types:r}))];if("bytes"===s){let e=o.length%2?"0":"";return o=`0x${e+o.slice(2)}`,[{type:"bytes32"},(0,m.S)(o)]}if("string"===s)return[{type:"bytes32"},(0,m.S)((0,g.nj)(o))];if(s.lastIndexOf("]")===s.length-1){let e=s.slice(0,s.lastIndexOf("[")),i=o.map(a=>t({name:n,type:e,types:r,value:a}));return[{type:"bytes32"},(0,m.S)((0,a.hd)(i.map(([e])=>e),i.map(([,e])=>e)))]}return[{type:s},o]}({name:i.name,type:i.type,types:n,value:t[i.name]});s.push(r),o.push(c)}return(0,a.hd)(s,o)}({data:r,primaryType:n,types:s});return(0,m.S)(e)})();o.push(e)}return(0,m.S)(l.xW(...o.map(e=>l.aD(e))))}(n),c=(0,a.hd)([{type:"bytes32"}],[i]);if(o=await r.personalAccount.signTypedData({domain:{chainId:r.chain.id,name:"Account",verifyingContract:e.address,version:"1"},message:{message:c},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]}}),await (0,p.isContractDeployed)(e)){if(await u({contract:e,hash:i,signature:o}))return o;throw Error("Failed to verify signature")}{let e=(0,v.HM)({accountSalt:r.overrides?.accountSalt,adminAddress:r.personalAccount.address,createAccountOverride:r.overrides?.createAccount,factoryContract:t});if(!e)throw Error("Create account override not provided");let a=await (0,y.encode)(e);return s({address:t.address,data:a,signature:o})}}}}]);