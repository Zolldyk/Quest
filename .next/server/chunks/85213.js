"use strict";exports.id=85213,exports.ids=[85213],exports.modules={85213:(a,b,c)=>{c.d(b,{smartAccountSignMessage:()=>t,smartAccountSignTypedData:()=>u});var d=c(28425),e=c(66652);function f({address:a,data:b,signature:c}){return(0,e.concatHex)([(0,d.hd)([{type:"address"},{type:"bytes"},{type:"bytes"}],[a,b,c]),"0x6492649264926492649264926492649264926492649264926492649264926492"])}var g=c(59654);let h=[{name:"hash",type:"bytes32"},{name:"signature",type:"bytes"}],i=[{type:"bytes4"}];async function j(a){return(0,g.readContract)({contract:a.contract,method:["0x1626ba7e",h,i],params:[a.hash,a.signature]})}async function k({hash:a,signature:b,contract:c}){try{return await j({contract:c,hash:a,signature:b})==="0x1626ba7e"}catch(a){return console.error("Error verifying EIP-1271 signature",a),!1}}var l=c(94443),m=c(73566),n=c(99608),o=c(56233),p=c(27924),q=c(76230),r=c(43533),s=c(95784);async function t({accountContract:a,factoryContract:b,options:c,message:e}){let g,h=function(a,b){let c="string"==typeof a?(0,o.Af)(a):a.raw instanceof Uint8Array?a.raw:(0,o.ZJ)(a.raw),d=(0,o.Af)(`\x19Ethereum Signed Message:
${c.length}`);return(0,p.S)(n.xW(d,c),void 0)}(e),i=(0,d.hd)([{type:"bytes32"}],[h]);if(g=await c.personalAccount.signTypedData({domain:{chainId:c.chain.id,name:"Account",verifyingContract:a.address,version:"1"},message:{message:i},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]}}),await (0,m.isContractDeployed)(a)){if(await k({contract:a,hash:h,signature:g}))return g;throw Error("Failed to verify signature")}{let a=(0,s.HM)({accountSalt:c.overrides?.accountSalt,adminAddress:c.personalAccount.address,createAccountOverride:c.overrides?.createAccount,factoryContract:b});if(!a)throw Error("Create account override not provided");let d=await (0,l.encode)(a);return f({address:b.address,data:d,signature:g})}}async function u({accountContract:a,factoryContract:b,options:c,typedData:e}){let g;if(e.domain?.verifyingContract?.toLowerCase()===a.address?.toLowerCase())return c.personalAccount.signTypedData(e);let h=function(a){let{domain:b={},message:c,primaryType:e}=a,f={EIP712Domain:q.HQ(b),...a.types};q.tf({domain:b,message:c,primaryType:e,types:f});let g=["0x1901"];if(b&&g.push(q.xy({domain:b,types:f})),"EIP712Domain"!==e){let a=(()=>{let a=function a({data:b,primaryType:c,types:e}){let f=[{type:"bytes32"}],g=[function({primaryType:a,types:b}){let c=(0,r.nj)(function({primaryType:a,types:b}){let c="",d=function a({primaryType:b,types:c},d=new Set){let e=b.match(/^\w*/u),f=e?.[0];if(d.has(f)||void 0===c[f])return d;for(let b of(d.add(f),c[f]))a({primaryType:b.type,types:c},d);return d}({primaryType:a,types:b});for(let e of(d.delete(a),[a,...Array.from(d).sort()])){if(!b[e])throw Error("Invalid types");c+=`${e}(${b[e].map(({name:a,type:b})=>`${b} ${a}`).join(",")})`}return c}({primaryType:a,types:b}));return(0,p.S)(c)}({primaryType:c,types:e})];if(!e[c])throw Error("Invalid types");for(let h of e[c]){let[c,i]=function b({types:c,name:e,type:f,value:g}){if(void 0!==c[f])return[{type:"bytes32"},(0,p.S)(a({data:g,primaryType:f,types:c}))];if("bytes"===f){let a=g.length%2?"0":"";return g=`0x${a+g.slice(2)}`,[{type:"bytes32"},(0,p.S)(g)]}if("string"===f)return[{type:"bytes32"},(0,p.S)((0,r.nj)(g))];if(f.lastIndexOf("]")===f.length-1){let a=f.slice(0,f.lastIndexOf("[")),h=g.map(d=>b({name:e,type:a,types:c,value:d}));return[{type:"bytes32"},(0,p.S)((0,d.hd)(h.map(([a])=>a),h.map(([,a])=>a)))]}return[{type:f},g]}({name:h.name,type:h.type,types:e,value:b[h.name]});f.push(c),g.push(i)}return(0,d.hd)(f,g)}({data:c,primaryType:e,types:f});return(0,p.S)(a)})();g.push(a)}return(0,p.S)(n.xW(...g.map(a=>n.aD(a))))}(e),i=(0,d.hd)([{type:"bytes32"}],[h]);if(g=await c.personalAccount.signTypedData({domain:{chainId:c.chain.id,name:"Account",verifyingContract:a.address,version:"1"},message:{message:i},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]}}),await (0,m.isContractDeployed)(a)){if(await k({contract:a,hash:h,signature:g}))return g;throw Error("Failed to verify signature")}{let a=(0,s.HM)({accountSalt:c.overrides?.accountSalt,adminAddress:c.personalAccount.address,createAccountOverride:c.overrides?.createAccount,factoryContract:b});if(!a)throw Error("Create account override not provided");let d=await (0,l.encode)(a);return f({address:b.address,data:d,signature:g})}}}};